<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" href="/favicon.png" />
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CodeZ Payments</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f8f9fa;
      min-height: 100vh;
    }

    .container {
      display: grid;
      grid-template-columns: 40% 60%;
      min-height: 100vh;
    }

    /* Left Column - Info Section */
    .left-section {
      background-color: #000;
      padding: 60px 50px;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .logo {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 40px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .info-section h2 {
      font-size: 28px;
      margin-bottom: 24px;
      font-weight: 600;
    }

    .info-list {
      list-style: none;
      margin-bottom: 40px;
    }

    .info-list li {
      padding: 16px 0;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      display: flex;
      align-items: flex-start;
      gap: 12px;
      font-size: 15px;
      line-height: 1.6;
    }

    .info-list li:last-child {
      border-bottom: none;
    }

    .info-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .terms {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid transparent;
      border-image: linear-gradient(to right, red, blue);
      border-image-slice: 1;
      font-size: 13px;
      line-height: 1.6;
      margin-top: auto;
    }

    .terms strong {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
    }

    /* Right Column - Form Section */
    .right-section {
      background: #181818;
      padding: 60px 80px;
      overflow-y: auto;
      color : #fff;
    }

    .form-header {
      margin-bottom: 40px;
    }

    .form-header h1 {
      font-size: 32px;
      color: #fff;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .form-header p {
      color: #fff;
      font-size: 16px;
    }

    .form-group {
      margin-bottom: 28px;
    }

    .form-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: #fff;
      font-size: 15px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.3s ease;
      font-family: inherit;
      background: white;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: red;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .form-group select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      padding-right: 45px;
    }

    .price-display {
      background: #f8f9fa;
      border: 2px solid #667eea;
      padding: 20px;
      border-radius: 12px;
      margin: 28px 0;
      display: none;
      align-items: center;
      justify-content: space-between;
    }

    .price-display.active {
      display: flex;
    }

    .price-display .label {
      font-size: 16px;
      color: #fff;
      font-weight: 500;
    }

    .price-display .amount {
      font-size: 36px;
      font-weight: 700;
      color: #667eea;
    }

    .pay-button {
      width: 100%;
      padding: 18px;
      background: linear-gradient(30deg, #C10B28, #FF2E2C, #2F0A6F, #0B00D0);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 12px;
    }

    .pay-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
    }

    .pay-button:active:not(:disabled) {
      transform: translateY(0);
    }

    .pay-button:disabled {
      background-color: #000;
      cursor: not-allowed;
      transform: none;
    }

    /* Success Message */
    .success-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .success-overlay.active {
      display: flex;
    }

    .success-card {
      background: #000;
      padding: 50px;
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: slideUp 0.4s ease;
      color: #fff;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .success-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 45px;
    }

    .success-card h2 {
      color: #fff;
      margin-bottom: 12px;
      font-size: 28px;
    }

    .success-card > p {
      color: #fff;
      margin-bottom: 30px;
      line-height: 1.6;
      font-size: 15px;
    }

    .download-button {
      display: inline-block;
      padding: 16px 40px;
      background: linear-gradient(30deg, #C10B28, #FF2E2C, #2F0A6F, #0B00D0);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      margin: 10px 0 24px;
      transition: all 0.3s ease;
      font-size: 16px;
    }

    .download-button:hover {
      background: linear-gradient(30deg, #C10B28, #FF2E2C, #2F0A6F, #0B00D0);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgb(146, 146, 146);
    }

    .order-details {
      background: #181818;
      padding: 24px;
      border-radius: 12px;
      margin-top: 24px;
      text-align: left;
      font-size: 14px;
    }

    .order-details p {
      margin-bottom: 10px;
      color: #fff;
      border-color: #fff;
    }

    .order-details strong {
      color: #fff;
    }

    .close-note {
      margin-top: 20px;
      font-size: 13px;
      color: #fff;
      font-style: italic;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .container {
        grid-template-columns: 1fr;
      }

      .left-section {
        padding: 40px 30px;
      }

      .right-section {
        padding: 40px 30px;
      }
    }

    @media (max-width: 600px) {
      .right-section {
        padding: 30px 20px;
      }

      .form-header h1 {
        font-size: 26px;
      }

      .success-card {
        padding: 30px 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Left Column: Info Section -->
    <div class="left-section">
      <div class="info-section">
        <div class="logo">
          <img src="https://github.com/codezwork/image-hosting/blob/main/CodeZ.png?raw=true" alt="" width="30%">
        </div>
        
        <h2>How It Works</h2>
        <ul class="info-list">
          <li>
            <span class="info-icon">âœ“</span>
            <span>Instant PDF download after successful payment</span>
          </li>
          <li>
            <span class="info-icon">ðŸ“§</span>
            <span>PDF will be delivered to your email address</span>
          </li>
          <li>
            <span class="info-icon">ðŸ”’</span>
            <span>Secure payment processing via Razorpay</span>
          </li>
          <li>
            <span class="info-icon">ðŸ’¯</span>
            <span>Quality educational materials</span>
          </li>
          <li>
            <span class="info-icon">âš¡</span>
            <span>24/7 access to your purchased content</span>
          </li>
        </ul>
      </div>

      <div class="terms">
        <strong>Terms & Conditions</strong>
        This unofficial guide has been created solely for educational purposes and is not connected with any official organizations or companies. All trademarks and registered trademarks belong to their respective owners.
      </div>
    </div>

    <!-- Right Column: Form Section -->
    <div class="right-section">
      <div class="form-header">
        <h1>Purchase Course Notes</h1>
        <p>Fill in your details to complete the purchase</p>
      </div>

      <form id="payment-form">
        <div class="form-group">
          <label for="name">Full Name *</label>
          <input type="text" id="name" name="name" placeholder="Enter your full name" required>
        </div>
        
        <div class="form-group">
          <label for="email">Email Address *</label>
          <input type="email" id="email" name="email" placeholder="your.email@example.com" required>
        </div>
        
        <div class="form-group">
          <label for="contact">Phone Number *</label>
          <input type="tel" id="contact" name="contact" placeholder="+91 98765 43210" required>
        </div>
        
        <div class="form-group">
          <label for="notes">Select Course Notes *</label>
          <select id="notes" name="notes" required>
            <option value="">-- Choose a course --</option>
          </select>
        </div>

        <div class="price-display" id="price-display">
          <span class="label">Total Amount:</span>
          <span class="amount" id="selected-price">â‚¹0</span>
        </div>
        
        <button type="button" class="pay-button" id="pay-button" onclick="payNow()" disabled>
          Proceed to Payment â†’
        </button>
      </form>
    </div>
  </div>

  <!-- Success Message Overlay -->
  <div class="success-overlay" id="success-overlay">
    <div class="success-card">
      <div class="success-icon">âœ“</div>
      <h2>Payment Successful!</h2>
      <p>Thank you for your purchase. Your payment has been verified successfully.</p>
      
      <a href="#" id="download-link" class="download-button" target="_blank">
        ðŸ“¥ Download Your PDF
      </a>
      
      <p style="font-size: 14px; color: #cecece;">
        The PDF has also been sent to your email address.
      </p>
      
      <div class="order-details">
        <p><strong>Order ID:</strong> <span id="order-id"></span></p>
        <p><strong>Payment ID:</strong> <span id="payment-id"></span></p>
      </div>

      <p class="close-note">You can close this window now</p>
    </div>
  </div>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    let notesData = [];

    document.addEventListener('DOMContentLoaded', function() {
      loadAvailableNotes();
      
      const form = document.getElementById('payment-form');
      const payButton = document.getElementById('pay-button');
      const notesSelect = document.getElementById('notes');
      const priceDisplay = document.getElementById('price-display');
      const selectedPriceEl = document.getElementById('selected-price');
      
      notesSelect.addEventListener('change', function() {
        const selectedNote = notesData.find(note => note.id === this.value);
        if (selectedNote) {
          selectedPriceEl.textContent = `â‚¹${selectedNote.price}`;
          priceDisplay.classList.add('active');
        } else {
          priceDisplay.classList.remove('active');
        }
      });

      form.addEventListener('input', function() {
        const isValid = form.checkValidity();
        payButton.disabled = !isValid;
      });
    });

    async function loadAvailableNotes() {
      try {
        const response = await fetch('/api/get-notes');
        notesData = await response.json();
        
        const notesSelect = document.getElementById('notes');
        notesData.forEach(note => {
          const option = document.createElement('option');
          option.value = note.id;
          option.textContent = `${note.name} - â‚¹${note.price}`;
          notesSelect.appendChild(option);
        });
      } catch (error) {
        console.error('Error loading notes:', error);
      }
    }

    async function payNow() {
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const contact = document.getElementById('contact').value;
      const selectedNote = document.getElementById('notes').value;

      if (!name || !email || !contact || !selectedNote) {
        alert('Please fill in all fields');
        return;
      }

      try {
        const response = await fetch('/api/create-order', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            selectedNote: selectedNote,
            name: name,
            email: email,
            contact: contact
          })
        });

        const order = await response.json();

        const notesSelect = document.getElementById('notes');
        const selectedOption = notesSelect.options[notesSelect.selectedIndex];
        const productName = selectedOption.textContent.split(' - â‚¹')[0];

        const options = {
          key: 'rzp_live_RP5EQelgnPuwiH',
          amount: order.amount,
          currency: order.currency,
          name: 'CodeZ Premium Notes',
          description: 'Premium ' + productName + 'by CodeZ',
          image: 'https://lh3.googleusercontent.com/pw/AP1GczMQbKDWowMuzoRs089fvavEm03I7x3sZYcpDE5hoGwXSmyg-r1jLlZNGLW7CXJif7XhN8HJeGuB5iIVH8fFjsc2P0c5Uj0aGZYSg2wEhKfnRLIYzvg3WCBU5jSJjQ-7uopcOoZ3CBgrfQqxfgfk6CQ=w1500-h1500-s-no-gm?authuser=0',
          order_id: order.id,
          prefill: {
            name: name,
            email: email,
            contact: contact
          },
          theme: {
            color: '#000000'
          },
          handler: function (response) {
            verifyPayment(response);
          },
          modal: {
            ondismiss: function() {
              console.log('Checkout form closed by user');
            }
          }
        };

        const rzp = new Razorpay(options);
        rzp.open();
        
      } catch (error) {
        console.error('Error:', error);
        alert('Error creating order. Please try again.');
      }
    }

    function verifyPayment(response) {
      fetch('/api/verify-payment', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          razorpay_order_id: response.razorpay_order_id,
          razorpay_payment_id: response.razorpay_payment_id,
          razorpay_signature: response.razorpay_signature
        })
      }).then(res => res.json())
        .then(data => {
          if (data.status === 'ok') {
            showSuccessMessage(response, data.download_link, data.product_name);
          } else {
            alert('Payment verification failed. Please contact support with your order ID: ' + response.razorpay_order_id);
          }
        }).catch(error => {
          console.error('Error:', error);
          alert('Error verifying payment. Please contact support with your order ID: ' + response.razorpay_order_id);
        });
    }

    function showSuccessMessage(response, downloadLink, productName) {
      document.getElementById('order-id').textContent = response.razorpay_order_id;
      document.getElementById('payment-id').textContent = response.razorpay_payment_id;
      document.getElementById('download-link').href = downloadLink;
      
      document.getElementById('success-overlay').classList.add('active');
      
      if (window.parent !== window) {
        window.parent.postMessage({
          type: 'PAYMENT_SUCCESS',
          order_id: response.razorpay_order_id,
          payment_id: response.razorpay_payment_id,
          product: productName,
          download_link: downloadLink
        }, '*');
      }
    }

    window.addEventListener('message', function(event) {
      if (event.data.type === 'INIT_PAYMENT') {
        console.log('Received init message from parent:', event.data);
      }
    });
  </script>
</body>
</html>
